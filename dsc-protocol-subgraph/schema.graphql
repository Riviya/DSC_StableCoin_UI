type Mint @entity(immutable: true) {
  id: ID!
  user: User!
  amount: BigInt!
  timestamp: BigInt!
  blockNumber: BigInt!
  transactionHash: Bytes!
}

type Burn @entity(immutable: true) {
  id: ID!
  user: User!
  amount: BigInt!
  timestamp: BigInt!
  blockNumber: BigInt!
  transactionHash: Bytes!
}

type User @entity(immutable: false) {
  id: ID! # user address
  totalDeposited: BigInt!
  totalMinted: BigInt!
  totalBurned: BigInt!
  collateralDeposits: [CollateralDeposit!]! @derivedFrom(field: "user")
  collateralRedemptions: [CollateralRedemption!]! @derivedFrom(field: "user")
  mints: [Mint!]! @derivedFrom(field: "user")
  burns: [Burn!]! @derivedFrom(field: "user")
  firstInteractionTimestamp: BigInt!
  lastInteractionTimestamp: BigInt!
}

type CollateralDeposit @entity(immutable: true) {
  id: ID!
  user: User!
  token: Bytes!
  amount: BigInt!
  timestamp: BigInt!
  blockNumber: BigInt!
  transactionHash: Bytes!
}

type CollateralRedemption @entity(immutable: true) {
  id: ID!
  user: User!
  token: Bytes!
  amount: BigInt!
  timestamp: BigInt!
  blockNumber: BigInt!
  transactionHash: Bytes!
}

type ProtocolStats @entity(immutable: false) {
  id: ID! # Always "1"
  totalCollateral: BigInt!
  totalUsers: Int!
  totalMintVolume: BigInt!
  totalBurnVolume: BigInt!
  totalNetMinted: BigInt! # totalMintVolume - totalBurnVolume
  lastUpdatedTimestamp: BigInt!
}

type MonthlyStats @entity(immutable: false) {
  id: ID! # Format: "YYYY-MM" (e.g., "2024-01")
  year: Int!
  month: Int!
  mintVolume: BigInt!
  burnVolume: BigInt!
  netMintVolume: BigInt! # mintVolume - burnVolume
  collateralDeposited: BigInt!
  collateralRedeemed: BigInt!
  netCollateral: BigInt! # collateralDeposited - collateralRedeemed
  newUsers: Int!
  activeUsers: Int! # Users who had any activity this month
  timestamp: BigInt! # First day of month timestamp
}

# Add (immutable: true) to the @entity directive here
type MonthlyActiveUser @entity(immutable: true) {
  id: ID! # Format: "YYYY-MM-USER_ADDRESS"
  user: User!
  month: MonthlyStats!
}

# Optional: Token-specific stats if you want per-token breakdowns
type TokenStats @entity(immutable: false) {
  id: ID! # token address
  tokenAddress: Bytes!
  totalDeposited: BigInt!
  totalRedeemed: BigInt!
  netDeposited: BigInt!
  lastUpdatedTimestamp: BigInt!
}